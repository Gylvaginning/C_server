<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="http://localhost:80/grensesnitt.css">
	<title>Startside</title>
  </head>
  <body onload="checkCookies()">
	  <p><a href="http://172.17.0.1/index.html"> Besøk nettsiden vår!</a></p>
	  <p id="demo"></p>
	  <p id="status">Du er utlogget</p>
	  <h2>Innlogging</h2>
	  
	  <form method="POST">
	      <label for="epost">Epostadresse:</label><br>
	      <input type="text" id="epost" name="epost"><br>
	      <label for="passord">Passord:</label><br>
	      <input type="password" id="passord" name="passord"><br>
	      <button id="login" type="button" onclick="innlogging()">Logg inn</button>
	      <button id="logut" type="button" onclick="utlogging()">Logg ut</button>
	  </form>
	
	<h2>Handlinger</h2>
	
	<form method="POST">
		<label for="hentdikt">Hent dikt</label><br>
		<input type="text" id="diktidGET" name="diktid" value="skriv diktID her, eller la være tom"><br>
		<button id="hentu" type="button" onclick='hent()'>Hent dikt</button>
		<br><br>
	</form>
	
	<form method="POST">
		<label for="publiserdikt">Publiser dikt</label><br>
		<input type="text" id="diktPOST" name="dikt" value="Skriv diktet ditt her" size="50"><br>
		<button id="postu" type="button" onclick='postDikt()'>Publiser dikt</button>
		<br><br>
	</form>
	
	<form method="POST">
		<label for="endreDikt">Endre dikt</label><br>
		<input type="text" id="diktPUTid" name="diktPUTid" value="Skriv diktID ditt her" size="50"><br>
		<input type="text" id="diktPUT" name="dikt" value="Skriv diktet ditt her" size="50"><br>
		<button id="putu" type="button" onclick='putDikt()'>Endre dikt</button>
		<br><br>
	</form>
	
	<form method="POST">
		<label for="sletteDikt">Slette dikt</label><br>
		<input type="text" id="diktslett" name="diktslett" value="Skriv diktID ditt her eller la stå tom for å slette alle dikt" size="50"><br>
		<button id="slettu" type="button" onclick='slettDikt()'>Slette dikt</button>
		<br><br>
	</form>
	
	<script>
		
	function checkCookies(){
		let xhttp = new XMLHttpRequest();
		xhttp.open("POST", url, false);
		xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
		xhttp.withCredentials = true;
		xhttp.send();
		let indikatortall = setTimeout(xhttp.getResponseHeader("Set-Cookie"), 1500);
		if(indikatortall != "") {
			document.getElementById('status').innerHTML = "Du er innlogget";
		}
		else {
			document.getElementById('status').innerHTML = "Du er utlogget";
		}
	}
		
		
	// Lage en hendelsesfunksjon for innlogging
	function innlogging(){
	
		// Lager et URL-objekt til bruk i fetch-metoden
		let basis = 'http://172.17.0.3/';
		let url = new URL('sqlite/database.db/dikt', basis);
		
		// Lager referanser til elementer i HTML-dokumentet		
		let epost =document.getElementById('epost');
		let passord =document.getElementById('passord');
		
		// Manipulere informasjonen inn i XML syntaks
		let response ="<bruker><epostadresse>"+epost.value+"</epostadresse><passordhash>"+passord.value+"</passordhash></bruker>";
		
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function () {
			if (xhttp.readyState == 4 && xhttp.status == 200) {
				console.log(xhttp.responseText);
				//console.log(xhttp.getResponseHeaders
			}
			/*else {
				console.log("Error");
				console.log("state:" + xhttp.readyState);
				console.log("status : " + xhttp.status);
			}*/
		};
		xhttp.open("POST", url, false);
		xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
		xhttp.withCredentials = true;
		xhttp.send(response);
		
		//alert(xhttp.getResponseHeader("Set-Cookie");
		var indikatortall = setTimeout(xhttp.getResponseHeader("Set-Cookie"), 1500);
		if(indikatortall != "") {
			document.getElementById('status').innerHTML = "Du er innlogget";
		}
		else {
			document.getElementById('status').innerHTML = "Du er utlogget";
		}
	}
	
	function utlogging() {
		
		// Lager et URL-objekt til bruk i fetch-metoden
		let basis = 'http://172.17.0.3/';
		let url = new URL('sqlite/database.db/dikt', basis);
		
		// Lager referanser til elementer i HTML-dokumentet		
		let epost =document.getElementById('epost');
		
		let response ="<bruker><epostadresse>"+epost.value+"</epostadresse></bruker>";
		
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function () {
			if (xhttp.readyState == 4 && xhttp.status == 200) {
				console.log(xhttp.responseText);
			}
			/*else {
				console.log("Error");
				console.log("state:" + xhttp.readyState);
				console.log("status : " + xhttp.status);
			}*/
		};
		xhttp.open("DELETE", 'http://172.17.0.3/sqlite/database.db/dikt', false);
		xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
		xhttp.withCredentials = true;
		xhttp.send(response);
		
		document.getElementById('status').innerHTML = "Du er utlogget";
	}
	
	function hent() {
		
		let id =document.getElementById('diktidGET');
		let basis = 'http://172.17.0.3/sqlite/database.db/dikt/';
		let url = new URL(id.value, basis);
		
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function () {
			if (xhttp.readyState == 4 && xhttp.status == 200) {
				document.getElementById('demo').innerHTML = xhttp.responseText;
				console.log(xhttp.responseText);
			}
		};
		setTimeout(xhttp.open("GET", url, false), 3000);
		xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
		xhttp.withCredentials = true;
		setTimeout(xhttp.send(), 1000);
	}
	
	function postDikt() {
		
		let dikt =document.getElementById('diktPOST');
		
		let response ="<dikt><tittel>"+dikt.value+"</tittel></dikt>";
		
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function () {
			if (xhttp.readyState == 4 && xhttp.status == 200) {
				console.log(xhttp.responseText);
			}
		};
		xhttp.open("POST", "http://172.17.0.3/sqlite/database.db/dikt", false);
		xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
		xhttp.withCredentials = true;
		xhttp.send(response);
	}
	
	function putDikt() {
		
		let dikt =document.getElementById('diktPUT');
		let id =document.getElementById('diktPUTid');
		
		alert ( "Dikt er: " + dikt.value + " og id er: " + id.value)
		
		//let basis = 'http://172.17.0.3/sqlite/database.db/dikt/';
		//let url = new URL(id.value, basis);
		
		//alert (url)
		let url ="http://172.17.0.3/sqlite/database.db/dikt/"+id.value;
		let response ="<dikt><tittel>"+dikt.value+"</tittel></dikt>";
		
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function () {
			if (xhttp.readyState == 4 && xhttp.status == 200) {
				console.log(xhttp.responseText);
			}
		};
		xhttp.open("PUT", url, false);
		xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
		xhttp.withCredentials = true;
		xhttp.send(response);
	}
	
	function slettDikt() {
		
		let dikt =document.getElementById('diktslett');
		
		let url ="http://172.17.0.3/sqlite/database.db/dikt/"+dikt.value;
		
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function () {
			if (xhttp.readyState == 4 && xhttp.status == 200) {
				console.log(xhttp.responseText);
			}
		};
		xhttp.open("DELETE", url, false);
		xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
		xhttp.withCredentials = true;
		xhttp.send();
	}
	
</script>
</body>
</html>
