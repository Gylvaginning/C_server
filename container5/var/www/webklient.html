<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="http://172.17.0.1/grensesnitt.css">
	<title>Startside</title>
  </head>
  <body>
	  <p><a href="http://172.17.0.1/index.html"> Besøk nettsiden vår!</a></p>
	  <h2>Innlogging</h2>
	  
	  <form method="POST">
	      <label for="epost">Epostadresse:</label><br>
	      <input type="text" id="epost" name="epost"><br>
	      <label for="passord">Passord:</label><br>
	      <input type="password" id="passord" name="passord"><br>
	      <button onclick="Innlogging()">Logg inn</button>
	      <input type="submit" name="metodevalg" value="Logg ut">
	  </form>
	
	<h2>Handlinger</h2>
	
	<script>
// Lage en hendelsesfunksjon for innlogging
function Innlogging(){
	
	// Lager et URL-objekt til bruk i fetch-metoden
	let basis = 'http://172.17.0.3/';
	let url = new URL('sqlite/database.db/dikt', basis);
	
	// Lager referanser til elementer i HTML-dokumentet		
	let epost =document.getElementById('epost');
	let passord =document.getElementById('passord');
	
	// Manipulere informasjonen inn i XML syntaks
	let response ="<bruker><epostadresse>"+epost.value+"</epostadresse><passordhash>"+passord.value+"</passordhash></bruker>";
	
	/*let svar = await fetch(url);
	let user = await svar.text();
	
	await new Promise((resolve, reject) => setTimeout(resolve, 3000));
	
	await Promise.reject(new Error("Whoops!"));
	
	return user;*/
	
	/*let fetchPromise = fetch(url, {
		method: "POST",
		origin: 'http://localhost',
		credentials: 'include',
		headers: {
			'Content-Type': 'application/x-www-form-urlencoded'},
		body: response 
	});
	.then(response => {
		if (!response.ok) {
			throw new Error('Network response was not ok');
		}
		return response.text();
	})
	.catch((error) => {
		console.error('There has been a problem with your fetch operation:', error);
		//alert("HTTP-Error: " + error);
	})*/
	// Fungerende fetch() logikk, men må ha med alert vinduet i else statementet for å oppnå HTTP 200 OK til REST API og databasen
	let fetchPromise = fetch(url, {
		method: "POST",
		origin: 'http://localhost',
		credentials: 'include',
		headers: {
			'Content-Type': 'application/x-www-form-urlencoded'},
		body: response 
	})
	.then(function(response) { 
		return response.text();
	})
	if (fetchPromise.ok){
		console.log(fetchPromise);
	}
	else {
		alert("HTTP-Error: " + fetchPromise.value);
	}
}
</script>
</body>
</html>
